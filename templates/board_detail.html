{% extends "base.html" %}

{% block title %}{{ board.title }} | UiPin{% endblock %}

{% block content %}
<div style="padding: 40px; text-align: center; color: white;">
    <h1 style="font-size: 36px; margin-bottom: 10px;">{{ board.title }}</h1>
    <p style="color: #888;">{{ board.description }}</p>
    <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 15px;">
        <img src="{{ url_for('static', path=user.profile_picture if user and user.profile_picture else 'images/default_avatar.jpg') }}" 
             style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">
        <span style="font-weight: bold;">{{ user.username }}</span>
    </div>
</div>

<div class="pin-grid">
    {% for pin in pins %}
    <div class="pin-card" id="pin-card-{{ pin.id }}" onclick="this.classList.toggle('flipped')">
        <div class="pin-inner">
            
            <div class="pin-front">
                <img src="{{ url_for('static', path=pin.image_path) }}" class="pin-image" onload="window.dispatchEvent(new Event('resize'));">
                
                <div class="pin-overlay">
                    <div class="pin-overlay-header">
                        <button onclick="event.stopPropagation(); openSaveModal('{{ pin.id }}')" class="btn-save-overlay">
                            Kaydet
                        </button>
                    </div>

                    <div class="pin-overlay-footer">
                        <div class="pin-user-info">
                            <img src="{{ url_for('static', path=pin.owner.profile_picture if pin.owner.profile_picture else 'images/default_avatar.jpg') }}" class="pin-user-avatar">
                            <span>{{ pin.owner.username }}</span>
                        </div>

                        <div class="pin-title-info">
                            {{ pin.title }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="pin-back">
    
    <div class="code-tabs">
        <button class="code-tab active" onclick="switchTab(event, 'desc-{{ pin.id }}')">
            <i class="fas fa-info-circle"></i> Detay
        </button>

        {% if pin.snippets %}
            {% for snippet in pin.snippets %}
            <button class="code-tab" onclick="switchTab(event, 'code-{{ snippet.id }}')">
                {{ snippet.language|upper }}
            </button>
            {% endfor %}
            
            <button class="code-tab" style="color: #e60023;" onclick="runPreview(event, '{{ pin.id }}')">
                <i class="fas fa-play"></i> Çalıştır
            </button>
        {% endif %}
    </div>

    <div class="code-content-container">
        
        <div id="desc-{{ pin.id }}" class="code-pane active" style="padding: 15px; font-size: 13px; line-height: 1.6; color: #ddd;">
            <strong style="display:block; margin-bottom:5px; color:white;">{{ pin.title }}</strong>
            {{ pin.description if pin.description else "Bu pin için açıklama girilmemiş." }}
            
            <div style="margin-top: 15px; font-size: 11px; color: #888;">
                <i class="fas fa-tag"></i> Etiket: {{ pin.tag }}<br>
                <i class="far fa-clock"></i> {{ pin.created_at.strftime('%d.%m.%Y') if pin.created_at else '' }}
            </div>
        </div>

        {% for snippet in pin.snippets %}
        <div id="code-{{ snippet.id }}" class="code-pane" data-lang="{{ snippet.language }}">
            <pre><code class="language-{{ snippet.language }}">{{ snippet.content }}</code></pre>
        </div>
        {% endfor %}
        
        <div id="preview-pane-{{ pin.id }}" class="code-pane" style="height: 100%; padding: 0;">
            <iframe id="iframe-{{ pin.id }}" style="width:100%; height:100%; border:none; background: #1e1e1e;"></iframe>
        </div>

    </div>
</div>
        </div>
    </div>
    {% endfor %}
    
    {% if not pins %}
        <p style="grid-column: 1 / -1; text-align: center; color: #666; margin-top: 40px;">Bu panoda henüz pin yok.</p>
    {% endif %}
</div>
{% endblock %}